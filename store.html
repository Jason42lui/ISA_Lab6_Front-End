<!DOCTYPE html>
<html>

<head>
    <title>Dictionary Store</title>
    <script src="storeString.js"></script>
</head>

<body>
    <h1>Dictionary Store</h1>

    <label for="word">Word:</label>
    <input type="text" id="word" placeholder="Enter the word" /><br /><br />

    <label for="wordLanguage">Word Language:</label>
    <select id="wordLanguage"></select>
    <br /><br />

    <label for="definition">Definition:</label>
    <textarea id="definition" placeholder="Enter the definition"></textarea>
    <br /><br />

    <label for="definitionLanguage">Definition Language:</label>
    <select id="definitionLanguage"></select>
    <br /><br />

    <button onclick="submitDefinition()">Submit</button>
    <button onclick="updateDefinition()">Update</button>
    <button onclick="deleteDefinition()">Delete</button>

    <div id="feedback"></div>
    <div class="home-button-container" id="home-button-container">
        <button onclick="goHome()">Home</button>
    </div>
</body>

<script>
    function goHome() {
        window.location.href = storeStrings.indexHTMLString;
    }

    function submitDefinition() {
        const word = document.getElementById(storeStrings.WORD_STRING).value;
        const definition = document.getElementById(storeStrings.DEFINITION_STRING).value;
        const wordLanguage = document.getElementById(storeStrings.WORD_LANGUAGE_STRING).value;
        const definitionLanguage = document.getElementById(storeStrings.DEFINITION_LANGUAGE_STRING).value;
        // Check if word and definition are not empty and perform basic input validation
        if (
            word &&
            definition
        ) {
            // Create params object
            const params = {
                word: word,
                definition: definition,
                word_language: wordLanguage,
                definition_language: definitionLanguage,
            };

            // Make xhttp request here
            const xhttp = new XMLHttpRequest();
            xhttp.open(storeStrings.POST_STRING, `${storeStrings.endPointRoot}${storeStrings.SUBMIT_UPDATE_DELETE_PATH}`, true);
            xhttp.setRequestHeader(storeStrings.CONTENT_TYPE_STRING, storeStrings.APPLICATION_JSON_STRING);
            xhttp.send(JSON.stringify(params));
            xhttp.onreadystatechange = () => {
                if (xhttp.readyState == 4 && xhttp.status == 200) {
                    // console.log("xhttp object.responseText", xhttp.responseText);
                    // let responseData = JSON.parse(xhttp.responseText);
                    // let responseText = responseData.responseText;
                    // console.log("response Data", responseData);
                    document.getElementById(storeStrings.WORD_STRING).value = storeStrings.EMPTY_STRING;
                    document.getElementById(storeStrings.DEFINITION_STRING).value = storeStrings.EMPTY_STRING;
                    document.getElementById(storeStrings.FEED_BACK_STRING).innerHTML = xhttp.responseText;
                }
            };
        } else {
            // Display error message if either word or definition is empty or contains non-alphabet characters
            document.getElementById(storeStrings.WORD_STRING).value = storeStrings.EMPTY_STRING;
            document.getElementById(storeStrings.DEFINITION_STRING).value = storeStrings.EMPTY_STRING;
            document.getElementById(storeStrings.FEED_BACK_STRING).innerHTML =  storeStrings.message;
        }
    }

    function updateDefinition() {
        const word = document.getElementById(storeStrings.WORD_STRING).value;
        const definition = document.getElementById(storeStrings.DEFINITION_STRING).value;
        const wordLanguage = document.getElementById(storeStrings.WORD_LANGUAGE_STRING).value;
        const definitionLanguage = document.getElementById(storeStrings.DEFINITION_LANGUAGE_STRING).value;
        if (
            word &&
            definition
        ) {
            const params = {
                word: word,
                definition: definition,
                word_language: wordLanguage,
                definition_language: definitionLanguage,
            };

            const xhttp = new XMLHttpRequest();
            xhttp.open(storeStrings.PATCH_STRING, `${storeStrings.endPointRoot}${storeStrings.SUBMIT_UPDATE_DELETE_PATH}`, true);
            xhttp.setRequestHeader(storeStrings.CONTENT_TYPE_STRING, storeStrings.APPLICATION_JSON_STRING);
            xhttp.send(JSON.stringify(params));
            xhttp.onreadystatechange = () => {
                if (xhttp.readyState == 4 && xhttp.status == 200) {
                    document.getElementById(storeStrings.FEED_BACK_STRING).innerHTML = xhttp.responseText;
                }
            };
        } else {
            document.getElementById(storeStrings.FEED_BACK_STRING).innerHTML = storeStrings.message;
        }
    }

    function deleteDefinition() {
        const word = document.getElementById(storeStrings.WORD_STRING).value;
        const definition = document.getElementById(storeStrings.DEFINITION_STRING).value;
        const wordLanguage = document.getElementById(storeStrings.WORD_LANGUAGE_STRING).value;
        const definitionLanguage = document.getElementById(storeStrings.DEFINITION_LANGUAGE_STRING).value;
        if (word) {
            const xhttp = new XMLHttpRequest();
            const url = `${storeStrings.endPointRoot}${storeStrings.SUBMIT_UPDATE_DELETE_PATH}${word}`;
            xhttp.open(storeStrings.DELETE_STRING, url, true);
            xhttp.send();
            xhttp.onreadystatechange = () => {
                if (xhttp.readyState == 4) {
                    if (xhttp.status == 200) {
                        document.getElementById(storeStrings.FEED_BACK_STRING).innerHTML = xhttp.responseText;
                    } else {
                        document.getElementById(storeStrings.FEED_BACK_STRING).innerHTML = storeStrings.ENTRY_NOT_FOUND_MESSAGE;
                    }
                }
            };
        } else {
            document.getElementById(storeStrings.FEED_BACK_STRING).innerHTML = storeStrings.message;
        }
    }

    document.addEventListener(storeStrings.DOM_STRING, function () {
        const xhr = new XMLHttpRequest();
        const wordLanguageSelect = document.getElementById(storeStrings.WORD_LANGUAGE_STRING);
        const definitionLanguageSelect = document.getElementById(storeStrings.DEFINITION_LANGUAGE_STRING);

        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    const data = JSON.parse(xhr.responseText);
                    console.log(data);

                    data.forEach(function (language) {
                        const option = document.createElement(storeStrings.OPTION_STRING);
                        option.text = language.language_name;
                        wordLanguageSelect.add(option);

                        const option2 = document.createElement(storeStrings.OPTION_STRING);
                        option2.text = language.language_name;
                        definitionLanguageSelect.add(option2);
                    });
                } else {
                    console.error(storeStrings.ERROR_LANGUAGE_MESSAGE, xhr.status);
                }
            }
        };
        xhr.open(storeStrings.GET_STRING, `${storeStrings.endPointRoot}${storeStrings.LANGUAGE_PATH}`);
        xhr.send();
    });
</script>

</html>